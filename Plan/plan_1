# Supabase 한도 초과 해결 및 리소스 최적화 계획 🛡️✨

하은님! 대표님~ 현재 프로젝트에서 발생하는 리소스 낭비와 "한도 초과" 경고를 해결하기 위한 정밀 최적화 플랜입니다! 🕵️‍♀️💻

## 🎯 주요 목표
- 불필요한 API 호출 및 에러(406) 발생 억제
- 데이터베이스 쿼리 성능 향상 (인덱스 추가)
- 리얼타임 리소스 효율화 (무한 폴링 제거)

## 🛠️ 제안하는 변경 사항

### 1. 프론트엔드 최적화 (API 호출 축소)
#### [MODIFY] [Home.jsx](file:///Users/uuser01/Desktop/유럽 중고거래/src/pages/Home.jsx)
- `popular_snapshots` 조회 시 `.single()`을 `.maybeSingle()`로 변경하여 데이터 부재 시 발생하는 406 에러 방지.
- 무분별한 에러 로그 누적 방지.

#### [MODIFY] [ChatRoom.jsx](file:///Users/uuser01/Desktop/유럽 중고거래/src/pages/ChatRoom.jsx)
- **2초 간격 무한 폴링 제거**: 이미 리얼타임 채널이 활성화되어 있으므로, 불필요한 폴링을 제거하여 API 호출 및 Egress(트래픽) 대폭 절감.

### 2. 데이터베이스 최적화 (성능 향상)
#### [SQL] 인덱스 추가 및 RLS 정책 정비
- **외래키 인덱스 생성**: `conversations`, `messages`, `posts` 등의 외래키에 인덱스를 추가하여 쿼리 성능 향상.
- **중복 정책 제거**: `posts`, `conversations` 테이블의 중복된 RLS 정책을 정리하여 보안 검사 부하 감소.

## 🏁 검증 계획
### 자동 테스트
- 브라우저 개발자 도구(Network 탭)를 사용하여 불필요한 API 호출이 사라졌는지 확인.
- 실시간 채팅이 폴링 없이도 정상적으로 동작하는지 확인.

### 수동 확인
- Supabase 대시보드에서 API Error Rate 및 Egress 증가 추이가 완화되는지 모니터링.
